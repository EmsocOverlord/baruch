import { Component, OnInit, ViewChild, ElementRef } from "@angular/core";

/**
 * Generated class for the LnChapterReader component.
 *
 * See https://angular.io/docs/ts/latest/api/core/index/ComponentMetadata-class.html
 * for more info on Angular Components.
 */
@Component({
  selector: "ln-chapter-reader",
  templateUrl: "ln-chapter-reader.html"
})
export class LnChapterReader implements OnInit {

  content: string;
  contents: string[];
  fontSize: number;
  @ViewChild("contentHolder") contentHolder: ElementRef;

  constructor() {
    console.log("Hello LnChapterReader Component", document.getElementsByName("ion-content"));
  }

  ngOnInit() {
    this.fontSize = 24;
    this.content = `\nYes, the mysterious man definitely was using this crossbow to kill the insect, looking at the pattern that was carved on it, he knows the crossbow is not normal, it must be because of this weapon so that man becomes so powerful.\n\t\nDiao Dingguo could not stop thinking,  “if this crossbow belonged to me, if I had such powerful weapon, then not only Fei Fei, even more, beautiful celebrities will seek protection from me, at that time I can do whatever I want”\n\t\nAs the saying goes,  greed makes someone does stupid things. Just when chu yun sheng turned around about to leave, diao ding guo pulls out a watermelon knife he has been hiding in his back, trying to stab chu yun sheng.\n\t\nEveryone is shocked by his sudden attack, the young man only saw a blade’s reflection flashed in front of his eyes, it is too late even he was trying to stop him.\n\t\nEven chu yun sheng is shocked as well, how can such an ungrateful man exists in the world, “I just saved their lives, now they want to kill me!” chu thought,  Even he did Ironically say a few words to the middle-aged man, but he still did not expect that guy would stab him！\n\t\nIn the eyes of , this mysterious man is dead, no one could survive in this range of a knife attack, it is a watermelon knife, even if this man did not die, he would be seriously injured, and then diao ding guo will take his crossbow. Everything seems so perfect.\n\t\nBut once again everyone was surprised by the result, the mysterious man is still standing there, did not even moved. Diao ding guo’s watermelon knife is dropped on the ground, and his hand is wounded, it is dripping blood on the floor, he is groaning with pain on the ground.\n\t\n“You wanted to kill me! ？”  chu yun sheng raged.\n\t\nIf it was not six armour yuan fu’s strong protection spell,  this guy could have killed him,  chu yun sheng is really furious, whatever he said, at least he saved this man's life, not only he didn't feel grateful, but he also tried to kill him, does he even has a basic human decency?\n\t\n“why?” chu yun sheng asked he tried to suppress his rage. He still feels strange.\n\t\nDiao ding guo knew he made another big mistake when the knife was bounced off, this man's power is beyond his imagination.\n\t\n“I ….. I ……” he is in great panic.\n\t\nChu yun sheng sneered at him ”don't tell me you lost your mind again and didn't know what you were doing”.\n\t\nDiao ding guo glimpses at crossbow unintentionally, then quickly moves his eyes away from it, he is trying to calm himself down and thinking for solutions.\n\t\nChu yun sheng already at yuan tian stage one, and six armour yuan fu also increase his overall strength, how can he not noticed Diao ding guo’s short glimpse!\n\t\nHe doesn't need too much time to think.  This guy wants his crossbow!\n\t\nChu yun sheng was angry and speechless at the same time, even if he had the crossbow, without any yuan qi, he would not be able to use it at all. And if he really had yuan qi, the yuan fu he cast onto the crossbow, has his personal signature on it. He still couldn't use it.\n\t\nDiao ding guo is such greedy and ungrateful human being. “ I don't need to be nice to this type of person, just kill him and feed him to the insect. “ Chu yun sheng’s first thought.\n\t\nBut when he pulls out the sword, points it at diao ding guo’s neck, he couldn't do it, he just has never killed anyone before. That's why he hesitates to do it.\n\t\nEven though he has seen so many horrible death recently, and he has killed some insects as well, but this is different, it is completely different feeling when he wants to kill his own kind, \n\t\nHe is not soft-hearted, for such people, Chu Yunsheng does not have the slightest sympathy.\n\t\nDiao ding guo scares almost collapsed when he saw chu yun sheng pulled out a sword, he did not think, his greedy could bring his own death. But he seems to selectively forget it was him tried to attack Chu Yunsheng first.\n\t\nHe saw chu yun sheng's hesitation,  Diao Dingguo seized the opportunity, he turns around and runs towards the room inside, although that is a dead end, maybe this time he really lost his mind.\n\t\nAlthough Chu Yunsheng hesitated, but he is not prepared to let go off this scum, Diao Dingguo is running fast, but Chu Yunshengs’ crossbow was even faster, at this close distance, he does not need to waste any yuan qi, an arrow direct shot into the Diao Dingguo thigh, Diao Ding guo falls over and hit the body on the ground, his pain and fear make him could not stop screaming.\n\t\nthe other five people see this are all scared to silence, no one dare and it seems not one willing to plead for diao ding guo, Chu Yunsheng has thought of a very good idea, he will shut the only door in the room, and then use the metal bar which was scattered around on the floor to lock the door, in this way he does not need to  kill the diao ding guo personally,  diao ding guo is either bleeds to death or starved to death inside!  In short, there is no way out.\n\t\nThis kind of death seems crueller than kill him directly, Chu Yunsheng thought, but then he hates this type of person the most, so he did not think too much about it.\n\t\n“This kind of bastard, you still believed him?” chu walked over and said sarcastically in front of young girl feifei.\n\t\nThe girl is scared, and she does not dare to look at him after heard what he said, she is like a frightened rabbit, quickly hiding aside.\n\t\n“Am I scary?” Chu Yunsheng thought, he suddenly felt a little bit depressed\n\t\n.\n\t\n\"Can you take us with you?\" The young man begged.\n\t\nChu Yunsheng looks at five people, shook his head and said: \"I have other things to do, you need to leave this place quickly, the blood smell is very heavy, and soon other insects will come.”\n\t\n\"But where can we go?\" Said a middle-aged woman, she was desperate.\n\t\n\"Go out, head west, there are lights and gunshots there, there are troops, you can go there!!\" Chu Yunsheng said quickly, he told them what he saw when he came here.\n\t\nYoung man immediately said:  \"No, we can’t,  in the west, there is a bridge, insects were guarding at that place, we tried several times, still  could not go past the bridge, we have lost several people as well!\"\n\t\nChu yun sheng heard they saw insects, he immediately asked with a trace of excitement,: \"insects? How many?”\n\t\nEveryone was gasped in surprise, this guy must be crazy, he is probably the only man in the world would get excited when he heard there are insects.\n\t\nThe young man is more certain about Chu Yunsheng mysterious ability,  he recalled: \"about two, one in the east of the bridge, one in the west, we went there several times, they are always like this.\n\t\n“Two…., although they were a little bit away from each other, but this distance means nothing to them.  It might be a little bit difficult,” Chu Yunsheng suddenly thought of another question, wondering: \"why do you want to cross the bridge, why didn't you try to go around the bridge from the north or the south.”\n\t\nThe young man has a wry smile: \"Brother, we tried, especially in the south there is a supermarket. most times we went there, and most  people died in there as well, there are insects on the street and in the supermarket, if we go there, we will die.”\n\t\n“of course one insect is always the best choice, but I do not get to see single insect very often, if I have to wait until I encounter just one insect, then my cultivation speed  be dramatically decreased, which is not what I wanted.” chu yun sheng thought\n\t\n“If there are two, then just kill these two!”  chu thought"`;
    this.paginateText();
  }

  paginateText() {
    var text = this.content; // gets the text, which should be displayed later on
    var textArray = text.split(" "); // makes the text to an array of words
    this.createPage(); // creates the first page
    for (var i = 0; i < textArray.length; i++) { // loops through all the words
      var success = this.appendToLastPage(textArray[i]); // tries to fill the word in the last page
      if (!success) { // checks if word could not be filled in last page
        this.createPage(); // create new empty page
        this.appendToLastPage(textArray[i]); // fill the word in the new last element
      }
    }

    // get the values per page
    var pagesContainer = document.getElementById("paginatedText").getElementsByClassName("page");
    var pagesValue = [];
    for (var i = 0; i < pagesContainer.length; i++) {
      pagesValue.push(pagesContainer[i].innerHTML);
    }
    this.contents = pagesValue;
  }

  createPage() {
    var page = document.createElement("div"); // creates new html element
    page.setAttribute("class", "page"); // appends the class "page" to the element
    document.getElementById("paginatedText").appendChild(page); // appends the element to the container for all the pages
  }

  appendToLastPage(word) {
    var page: any = document.getElementsByClassName("page")[document.getElementsByClassName("page").length - 1]; // gets the last page
    var pageText = page.innerHTML; // gets the text from the last page
    page.innerHTML += word + " "; // saves the text of the last page
    if (page.offsetHeight < page.scrollHeight) { // checks if the page overflows (more words than space)
      page.innerHTML = pageText; //resets the page-text
      return false; // returns false because page is full
    } else {
      return true; // returns true because word was successfully filled in the page
    }
  }
}
